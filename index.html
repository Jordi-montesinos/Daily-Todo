<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weekly Task Organizer</title>

    <!-- React + Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  </head>

  <body class="bg-gray-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const WeeklyTaskOrganizer = () => {
        const defaultWeek = () => ({
          id: Date.now(),
          tasks: Array(16)
            .fill(null)
            .map((_, i) => ({
              delegatedTasks: { text: "", completed: false, ranking: i + 1 },
              weeklyObjectives: { text: "", completed: false, ranking: i + 1 },
              monday: { text: "", completed: false, ranking: i + 1 },
              tuesday: { text: "", completed: false, ranking: i + 1 },
              wednesday: { text: "", completed: false, ranking: i + 1 },
              thursday: { text: "", completed: false, ranking: i + 1 },
              friday: { text: "", completed: false, ranking: i + 1 },
            })),
        });

        const [weeks, setWeeks] = useState(() => {
          const saved = localStorage.getItem("weekly-task-organizer");
          return saved ? JSON.parse(saved) : [defaultWeek()];
        });

        const [draggedItem, setDraggedItem] = useState(null);
        const fileInputRef = useRef(null);

        const columns = [
          "delegatedTasks",
          "weeklyObjectives",
          "monday",
          "tuesday",
          "wednesday",
          "thursday",
          "friday",
        ];
        const columnLabels = [
          "Delegated Tasks",
          "Weekly Objectives",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
        ];

        const getWeeklyObjectivesColor = (i) => {
          if (i <= 3)
            return { bg: "bg-red-600", text: "text-white", input: "bg-red-500 text-white" };
          if (i <= 7)
            return { bg: "bg-orange-500", text: "text-white", input: "bg-orange-400 text-white" };
          if (i <= 11)
            return { bg: "bg-yellow-400", text: "text-black", input: "bg-yellow-300 text-black" };
          return { bg: "bg-yellow-200", text: "text-black", input: "bg-yellow-100 text-black" };
        };

        const getDayColumnColor = (i) => {
          if (i === 0)
            return { bg: "bg-red-600", text: "text-white", input: "bg-red-500 text-white" };
          if (i <= 3)
            return { bg: "bg-yellow-300", text: "text-black", input: "bg-yellow-200 text-black" };
          if (i >= 14)
            return { bg: "bg-blue-50", text: "text-black", input: "bg-blue-100 text-black" };
          return { bg: "bg-white", text: "text-black", input: "bg-white text-black" };
        };

        const getCellStyle = (col, i) =>
          col === "weeklyObjectives"
            ? getWeeklyObjectivesColor(i)
            : col === "delegatedTasks"
            ? { bg: "bg-white", text: "text-black", input: "bg-white text-black" }
            : getDayColumnColor(i);

        const updateTask = (weekId, rowIndex, column, field, value) => {
          setWeeks((prev) =>
            prev.map((w) => {
              if (w.id !== weekId) return w;
              const updated = [...w.tasks];
              updated[rowIndex] = {
                ...updated[rowIndex],
                [column]: { ...updated[rowIndex][column], [field]: value },
              };
              return { ...w, tasks: updated };
            })
          );
        };

        const handleDragStart = (e, weekId, row, col) => {
          setDraggedItem({ weekId, row, col });
          e.dataTransfer.effectAllowed = "move";
        };

        const handleDrop = (e, weekId, targetRow, col) => {
          e.preventDefault();
          if (!draggedItem || draggedItem.weekId !== weekId || draggedItem.col !== col) return;
          setWeeks((prev) =>
            prev.map((w) => {
              if (w.id !== weekId) return w;
              const tasks = [...w.tasks];
              [tasks[draggedItem.row][col], tasks[targetRow][col]] = [
                tasks[targetRow][col],
                tasks[draggedItem.row][col],
              ];
              return { ...w, tasks };
            })
          );
          setDraggedItem(null);
        };

        const addNewWeek = () => setWeeks([{ ...defaultWeek() }, ...weeks]);
        const deleteWeek = (id) => weeks.length > 1 && setWeeks(weeks.filter((w) => w.id !== id));

        const saveToFile = () => {
          const blob = new Blob([JSON.stringify(weeks, null, 2)], { type: "application/json" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "weekly-organizer.json";
          a.click();
          URL.revokeObjectURL(a.href);
        };

        const loadFromFile = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (ev) => {
            try {
              const data = JSON.parse(ev.target.result);
              setWeeks(data);
              localStorage.setItem("weekly-task-organizer", JSON.stringify(data));
            } catch {
              alert("Invalid file format");
            }
          };
          reader.readAsText(file);
        };

        // ðŸŒŸ Auto-save to localStorage
        useEffect(() => {
          localStorage.setItem("weekly-task-organizer", JSON.stringify(weeks));
        }, [weeks]);

        useEffect(() => lucide.createIcons());

        return (
          <div className="p-6 max-w-[1800px] mx-auto">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-3xl font-bold text-gray-800">Weekly Task Organizer</h1>
              <div className="flex gap-3">
                <button
                  onClick={saveToFile}
                  className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg"
                >
                  <i data-lucide="save" className="w-4 h-4"></i> Save
                </button>
                <button
                  onClick={() => fileInputRef.current?.click()}
                  className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg"
                >
                  <i data-lucide="upload" className="w-4 h-4"></i> Load
                </button>
                <input
                  ref={fileInputRef}
                  type="file"
                  accept=".json"
                  onChange={loadFromFile}
                  className="hidden"
                />
                <button
                  onClick={addNewWeek}
                  className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
                >
                  <i data-lucide="plus" className="w-4 h-4"></i> Add Week
                </button>
              </div>
            </div>

            {weeks.map((week, index) => (
              <div key={week.id} className="mb-8 bg-white rounded-lg shadow p-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-semibold text-gray-700">
                    Week {weeks.length - index}
                  </h2>
                  {weeks.length > 1 && (
                    <button
                      onClick={() => deleteWeek(week.id)}
                      className="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm"
                    >
                      <i data-lucide="trash-2" className="w-4 h-4"></i> Delete
                    </button>
                  )}
                </div>

                <div className="overflow-x-auto">
                  <table className="w-full border-collapse">
                    <thead>
                      <tr>
                        {columnLabels.map((label) => (
                          <th
                            key={label}
                            className="border border-gray-300 p-2 bg-gray-700 text-white text-sm"
                          >
                            {label}
                          </th>
                        ))}
                      </tr>
                    </thead>
                    <tbody>
                      {week.tasks.map((task, row) => (
                        <tr key={row}>
                          {columns.map((col) => {
                            const style = getCellStyle(col, row);
                            return (
                              <td
                                key={col}
                                className={`border border-gray-300 p-1 ${style.bg}`}
                                draggable
                                onDragStart={(e) => handleDragStart(e, week.id, row, col)}
                                onDragOver={(e) => e.preventDefault()}
                                onDrop={(e) => handleDrop(e, week.id, row, col)}
                              >
                                <div className="flex items-start gap-1">
                                  <i data-lucide="grip-vertical" className={`w-3 h-3 ${style.text}`}></i>
                                  <input
                                    type="checkbox"
                                    checked={task[col].completed}
                                    onChange={(e) =>
                                      updateTask(week.id, row, col, "completed", e.target.checked)
                                    }
                                    className="w-3.5 h-3.5 mt-0.5"
                                  />
                                  <input
                                    type="number"
                                    min="1"
                                    value={task[col].ranking}
                                    onChange={(e) =>
                                      updateTask(week.id, row, col, "ranking", e.target.value)
                                    }
                                    className={`w-8 text-xs text-center border-0 outline-none ${style.input}`}
                                  />
                                  <textarea
                                    value={task[col].text}
                                    onChange={(e) =>
                                      updateTask(week.id, row, col, "text", e.target.value)
                                    }
                                    className={`flex-1 text-xs border-0 outline-none resize-none ${style.input}`}
                                    placeholder="Task..."
                                    rows="1"
                                  />
                                </div>
                              </td>
                            );
                          })}
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            ))}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<WeeklyTaskOrganizer />);
    </script>
  </body>
</html>
